generator client {
  provider = "prisma-client-js"
}

datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}


model user {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   email                 String?           @unique(map: "user_sub_unique")
   password              String?           // 4-digit pin-code for patients
   type                  UserType          @default(student)
   accept_cgu            Boolean?
   admin                 Boolean           @default(false)

   google_id             String?           @unique(map: "uses_google_id_unique")
   name                  String?
   picture               String?

   user_actions          user_action[]
   user_topics           user_topic[]
   user_text_annotations user_text_annotation[]
}

enum UserType {
   admin
   student
}


model ue {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   name                  String
   rank                  Int

   sub_ue_list           sub_ue[]
}

model sub_ue {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   name                  String
   ue_id                 Int
   rank                  Int

   ue                    ue                @relation(fields: [ue_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   topics                topic[]
}

model topic {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   name                  String
   sub_ue_id             Int
   rank                  Int
   course_content        String            @default("")

   sub_ue                sub_ue            @relation(fields: [sub_ue_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   cards                 card[]
   case_studies          case_study[]
   quizes                quiz[]
   user_text_annotations user_text_annotation[]
   user_topics           user_topic[]
}


model card {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   topic_id              Int
   rank                  Int
   title                 String
   content               String

   topic                 topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model case_study {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   topic_id              Int
   rank                  Int
   title                 String
   content               String

   topic                 topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model quiz {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   topic_id              Int
   rank                  Int
   title                 String
   question              String

   topic                 topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   quiz_choices          quiz_choice[]
}

model quiz_choice {
   id                    Int               @id @default(autoincrement())
   created_at            DateTime          @default(now()) @db.Timestamptz(6)
   quiz_id               Int
   rank                  Int
   text                  String
   answer                Boolean
   comment               String
   positive_points       Int
   negative_points       Int

   quiz                  quiz              @relation(fields: [quiz_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}


model user_action {
   id                    Int               @default(autoincrement()) @id
   time                  DateTime          @default(now()) @db.Timestamptz(6)
   user_id               Int
   action                String

   user                  user              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}


model user_topic {
   id                    Int               @default(autoincrement()) @id
   time                  DateTime          @default(now()) @db.Timestamptz(6)
   user_id               Int               
   topic_id              Int
   done                  Boolean           @default(false)

   user                  user              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   topic                 topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   @@unique([user_id, topic_id])
}

model user_text_annotation {
   id                    Int               @default(autoincrement()) @id
   time                  DateTime          @default(now()) @db.Timestamptz(6)
   user_id               Int
   topic_id              Int
   text                  String
   x                     Int
   y                     Int

   user                  user               @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
   topic                 topic              @relation(fields: [topic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}
